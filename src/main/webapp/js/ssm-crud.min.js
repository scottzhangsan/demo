/*! ssm-crud 2017-10-26 */
function to_page(a){$.ajax({url:"/ssm-crud/emps",data:{pn:a},type:"GET",success:function(a){build_emps_table(a),build_page_info(a),build_page_nav(a)}})}function build_emps_table(a){$("#emps_table tbody").empty(),$.each(a.extend.page.list,function(a,b){var c=$("<td><input type='checkbox' class='check_item'/></td>"),d=$("<td></td>").append(b.empId),e=$("<td></td>").append(b.empName),f=$("<td></td>").append(b.email),g=$("<td></td>").append(b.gender),h=$("<td></td>").append(b.department.deptName),i=$("<button></button>").addClass("btn btn-primary  btn-sm  edit_btn").append($("<span></span>").addClass("glyphicon glyphicon-pencil").append("修改")).attr("update_id",b.empId),j=$("<button></button>").addClass("btn btn-danger  btn-sm  del_btn").append($("<span></span>").addClass("glyphicon glyphicon-trash").append("删除")).attr("del_id",b.empId),k=$("<td></td>").append(i).append(j);$("<tr></tr>").append(c).append(d).append(e).append(g).append(f).append(h).append(k).appendTo($("#emps_table tbody"))})}function build_page_info(a){$("#page_info_area").empty(),$("#page_info_area").append("当前第"+a.extend.page.pageNum+"页，总共有"+a.extend.page.pages+"页，总共"+a.extend.page.total+"条记录数")}function build_page_nav(a){$("#page_nav_area").empty();var b=$("<ul></ul>").addClass("pagination"),c=$("<li></li>").append($("<a></a>").append("首页").attr("href","#")),d=$("<li></li>").append($("<a></a>").append("&laquo;"));0==a.extend.page.hasPreviousPage?(c.addClass("disable"),d.addClass("disable")):(c.click(function(){to_page(1)}),d.click(function(){to_page(a.extend.page.pageNum-1)}));var e=$("<li></li>").append($("<a></a>").append("&raquo;")),f=$("<li></li>").append($("<a></a>").append("末页").attr("href","#"));0==a.extend.page.hasNextPage?(e.addClass("disable"),f.addClass("disable")):(e.click(function(){to_page(a.extend.page.pageNum+1)}),f.click(function(){to_page(a.extend.page.pages)})),b.append(c).append(d),$.each(a.extend.page.navigatepageNums,function(c,d){if(d===a.extend.page.pageNum)var e=$("<li></li>").append($("<a></a>").append(d)).addClass("active");else var e=$("<li></li>").append($("<a></a>").append(d));e.click(function(){to_page(d)}),b.append(e)}),b.append(e).append(f),$("<nav></nav)").append(b).appendTo($("#page_nav_area"))}function toAddEmployee(){$("#empName_add_input").val(""),$("#email_add_input").val(""),getAllDeptmentInfo("#empAddModal select"),$("#empAddModal").modal({backdrop:"static"})}function getAllDeptmentInfo(a){$(a).empty(),$.ajax({url:"/ssm-crud/depts",type:"GET",success:function(b){$.each(b.extend.dept,function(b,c){$("<option></option>").append(c.deptName).attr("value",c.deptId).appendTo(a)})}})}function addEmployee(){if(!validate_add_form())return!1;var a=$("#empAddModal form").serialize();$.ajax({url:"/ssm-crud/insertEmp",data:a,type:"POST",success:function(a){console.log(a),200==a.code?a.extend.filedErrors.empName?($("#empName_add_input").parent().removeClass("has-error has-success"),$("#empName_add_input").parent().addClass("has-error"),$("#empName_add_input").next("span").text("姓名只允许输入3-16位的字母或者数字")):a.extend.filedErrors.email&&($("#email_add_input").parent().removeClass("has-error has-success"),$("#email_add_input").parent().addClass("has-error"),$("#email_add_input").next("span").text("邮箱输入不正确")):($("#empAddModal").modal("hide"),to_page(1))}})}function validate_add_form(){var a=$("#empName_add_input").val(),b=$("#email_add_input").val(),c=/(^[a-z0-9]{3,16}$)/,d=/^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/;return c.test(a)?($("#empName_add_input").parent().removeClass(),$("#empName_add_input").parent().addClass("has-error has-success"),$("#empName_add_input").next("span").text("")):($("#empName_add_input").parent().removeClass(),$("#empName_add_input").parent().addClass("has-error has-success"),$("#empName_add_input").next("span").text("姓名只允许输入3-16位的字母或者数字")),d.test(b)?($("#email_add_input").parent().removeClass(),$("#email_add_input").parent().addClass("has-error has-success"),$("#email_add_input").next("span").text("")):($("#email_add_input").parent().removeClass(),$("#email_add_input").parent().addClass("has-error has-success"),$("#email_add_input").next("span").text("邮箱输入不正确")),!(!c.test(a)||!d.test(b))}function judgeName(a){$.ajax({url:"/ssm-crud/judge",data:"empName="+a,type:"GET",success:function(a){return 200!=a.code}})}function getEmpById(a){$.ajax({url:"/ssm-crud/emp/"+a,type:"GET",success:function(a){console.log(a);var b=a.extend.emp;$("#empName_update_static").text(b.empName),$("#email_update_input").val(b.email),$("#empUpdateModal select").val([b.deptId+""])}})}var totalRecord,currentPage;$(function(){to_page(1)}),$("#empName_add_input").change(function(){var a=$("#empName_add_input").val();$.ajax({url:"/ssm-crud/judge",data:"empName="+a,type:"GET",success:function(a){console.log(a),200==a.code?($("#empName_add_input").parent().removeClass("has-error has-success"),$("#empName_add_input").parent().addClass("has-error"),$("#empName_add_input").next("span").text("用户名重复")):($("#empName_add_input").parent().removeClass("has-error has-success"),$("#empName_add_input").parent().addClass("has-success"),$("#empName_add_input").next("span").text(""))}})}),$(document).on("click",".edit_btn",function(){getEmpById($(this).attr("update_id")),getAllDeptmentInfo("#empUpdateModal select"),$("#emp_update_btn").attr("edit-id",$(this).attr("update_id")),$("#empUpdateModal").modal({backdrop:"static"})}),$("#emp_update_btn").click(function(){console.log($("#empUpdateModal form").serialize()),$.ajax({url:"/ssm-crud/update/"+$(this).attr("edit-id"),data:$("#empUpdateModal form").serialize(),type:"PUT",success:function(a){$("#empUpdateModal").modal("hide"),to_page(1)}})}),$(document).on("click",".del_btn",function(){var a=$(this).parents("tr").find("td:eq(1)").text();if(confirm("确认删除"+a+"吗？")){var b=$(this).attr("del_id");$.ajax({url:"/ssm-crud/delEmp/"+b,type:"DELETE",success:function(a){to_page(1)}})}}),$("#check_all").click(function(){$(".check_item").prop("checked",$(this).prop("checked"))}),$(document).on("click",".check_item",function(){var a=$(".check_item:checked").length==$(".check_item").length;$("#check_all").prop("checked",a)}),$("#emp_delete_all_btn").click(function(){if(0===$(".check_item:checked").length)return void alert("请先选择数据，在进行删除");var a="";$.each($(".check_item:checked"),function(b,c){a+=$(c).parents("tr").find("td:eq(1)").text()+"-"}),a=a.substring(0,a.length-1),confirm("确认进行批量删除吗？")&&$.ajax({url:"/ssm-crud/delEmps/"+a,type:"DELETE",success:function(a){console.log(a),to_page(1)}})});